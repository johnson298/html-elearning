<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Form</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="./style.css" />
  </head>

  <body>
    <div
      class="container d-flex justify-content-center align-items-center"
      style="height: 100vh"
    >
      <button
        id="open-login-modal"
        type="button"
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#modal-regis"
      >
        Open modal login
      </button>
    </div>
    <div class="container">
      <div
        class="modal fade modal-regis"
        id="modal-regis"
        tabindex="-1"
        aria-labelledby="loginModalLabel"
        aria-hidden="true"
        data-bs-backdrop="static"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="payment-container position-relative">
              <button class="close-btn text-secondary">&times;</button>

              <div class="payment-header-t">
                <div class="progress-steps">
                  <div class="progress-line"></div>
                  <div class="step" id="step-1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Thông tin</div>
                  </div>
                  <div class="step" id="step-2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Chuyển khoản</div>
                  </div>
                  <div class="step" id="step-3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Thành công</div>
                  </div>
                </div>

                <div class="payment-header-b">
                  <div class="payment-header">
                    <h5 class="mb-0 fw-bold">
                      Khóa học bán hàng Shopee chuyên nghiệp
                    </h5>
                  </div>
                  <div class="price-info">
                    <span>Giá gốc:</span>
                    <span>4.000.000 VND</span>
                  </div>
                  <div class="price-info">
                    <span>Giá ưu đãi hôm nay:</span>
                    <span>4.000.000 VND</span>
                  </div>
                  <div class="price-info">
                    <span style="color: #105ce4"
                      ><span>Mã giảm giá</span> -
                      <span style="color: #dc3f2e; text-decoration: underline"
                        >Hủy bỏ</span
                      ></span
                    >
                    <span class="price">4.000.000 VND</span>
                  </div>

                  <div class="input-group mt-3">
                    <input
                      type="text"
                      class="form-control"
                      id="couponInput"
                      placeholder="Mã ưu đãi"
                    />
                    <button
                      class="btn code-btn text-white"
                      type="button"
                      id="applyCoupon"
                    >
                      Áp dụng
                    </button>
                  </div>

                  <div class="d-flex align-items-center mt-2">
                    <i class="bi bi-tag-fill text-danger me-2"></i>
                    <a
                      href="#"
                      class="text-decoration-none text-danger"
                      id="showCoupons"
                    >
                      Xem danh sách mã giảm giá
                    </a>
                  </div>

                  <div class="coupon-container" id="couponList">
                    <button class="coupon-btn" data-code="GIAM150K">
                      <span class="coupon-tag">HOT</span>GIAM150K
                    </button>
                    <button class="coupon-btn" data-code="GIAM100K">
                      GIAM100K
                    </button>
                    <button class="coupon-btn" data-code="GIAM50K">
                      GIAM50K
                    </button>
                    <button class="coupon-btn" data-code="GIAM15OK">
                      GIAM15OK
                    </button>
                  </div>

                  <div class="total-price">
                    <span class="fw-bold">Tổng thanh toán:</span>
                    <span class="price">4.000.000 VND</span>
                  </div>
                </div>
              </div>

              <div class="payment-body">
                <!-- Tab 1: Information -->
                <div class="tab-content" id="tab-1">
                  <div class="user-info-container">
                    <h6 class="fw-bold mb-3">Thông tin của bạn:</h6>
                    <p class="mb-4">
                      Bạn đã có tài khoản?
                      <a href="#" class="login-link">Ấn vào đây để đăng nhập</a>
                    </p>

                    <div class="mb-4 form-wrap">
                      <label for="email" class="form-label">Email:</label>
                      <input type="email" class="form-control" id="email" />
                    </div>

                    <div class="mb-4 form-wrap">
                      <label for="password" class="form-label">Mật khẩu:</label>
                      <div class="password-field">
                        <input
                          type="password"
                          class="form-control"
                          id="password"
                        />
                        <button class="password-toggle">
                          <i class="bi bi-eye-slash"></i>
                        </button>
                      </div>
                    </div>

                    <div class="mb-4 form-wrap">
                      <label for="phone" class="form-label"
                        >Số điện thoại *:</label
                      >
                      <div class="input-group phone-group">
                        <button
                          class="btn btn-outline-secondary dropdown-toggle"
                          type="button"
                          data-bs-toggle="dropdown"
                        >
                          <img
                            src="https://flagcdn.com/w20/vn.png"
                            width="20"
                            height="15"
                            alt="Vietnam"
                          />
                          +84
                        </button>
                        <input
                          type="tel"
                          class="form-control"
                          id="phone"
                          required
                        />
                      </div>
                    </div>

                    <p class="small text-muted mb-3">
                      Thông tin cá nhân của bạn sẽ được sử dụng để xử lý đơn
                      hàng, tăng trải nghiệm sử dụng website, và cho các mục
                      đích cụ thể khác đã được mô tả trong
                      <a href="#" class="privacy-link">chính sách riêng tư</a>
                      của chúng tôi.
                    </p>

                    <div class="form-check mb-3">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="terms"
                        required
                      />
                      <label class="form-check-label" for="terms">
                        Tôi đã đọc và đồng ý với
                        <a href="#" class="privacy-link"
                          >điều khoản và điều kiện</a
                        >
                        của website
                      </label>
                    </div>
                    <button class="btn" id="btn-checkout-regis">
                      Tiến hành thanh toán
                    </button>
                  </div>

                  <div class="nav-buttons">
                    <button class="nav-btn prev-btn" disabled>Quay lại</button>
                    <button class="nav-btn next-btn" onclick="nextTab()">
                      Tiếp tục
                    </button>
                  </div>
                </div>

                <!-- Tab 2: Payment -->
                <div class="tab-content" id="tab-2">
                  <div class="payment-methods-container">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="method-option">
                          <div class="method-title">
                            <strong>Cách 1:</strong> Mở app ngân hàng/Ví và
                            <strong>Quét mã QR</strong>
                          </div>
                          <div class="qr-container">
                            <img
                              src="./assets/images/border-bank.png"
                              alt="SePay QR Code"
                              class="border-bank img-fluid mb-2"
                            />
                            <img
                              src="./assets/images/qr-code.png"
                              alt="SePay QR Code"
                              class="img-fluid mb-2 img-bank"
                              id="payment-qr-code"
                            />
                          </div>
                          <button class="download-btn" id="download-qr-code">
                            <i class="bi bi-download me-2"></i> Tải ảnh QR
                          </button>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="method-option">
                          <div class="method-title">
                            <strong>Cách 2:</strong> Chuyển khoản
                            <strong>thủ công</strong> theo thông tin
                          </div>
                          <div class="body-method-option">
                            <div
                              class="d-flex align-items-center justify-content-center pt-2"
                            >
                              <img
                                src="./assets/images/ocb-bank.png"
                                alt="OCB"
                                class="me-2"
                                width="50"
                              />
                            </div>

                            <div class="bank-info">
                              <div class="bank-info-row">
                                <span class="bank-info-label">Ngân hàng:</span>
                                <span class="bank-info-value">OCB</span>
                              </div>
                              <div class="bank-info-row">
                                <span class="bank-info-label">Thụ hưởng:</span>
                                <span class="bank-info-value"
                                  >NGUYỄN QUỐC ANH</span
                                >
                              </div>
                              <div class="bank-info-row">
                                <span class="bank-info-label"
                                  >Số tài khoản:</span
                                >
                                <span class="bank-info-value"
                                  >SEPAnhNguyenNNS</span
                                >
                              </div>
                              <div class="bank-info-row">
                                <span class="bank-info-label">Số tiền:</span>
                                <span class="bank-info-value"
                                  >4.000.000 VND</span
                                >
                              </div>
                              <div class="bank-info-row">
                                <span class="bank-info-label"
                                  >Nội dung CK:</span
                                >
                                <span class="bank-info-value">NNS11914</span>
                              </div>
                            </div>

                            <div class="warning-box">
                              <i
                                class="bi bi-exclamation-triangle-fill warning-icon"
                              ></i>
                              <span class="fw-bold">Lưu ý:</span>
                              Vui lòng giữ nguyên nội dung chuyển khoản
                              <strong>NNS11914</strong> để xác nhận thanh toán
                              tự động.
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="timer-container">
                      <div>Thanh toán sẽ hết hạn sau:</div>
                      <div class="timer">00:15:00</div>
                    </div>

                    <div class="status-container">
                      <strong>Trạng thái:</strong> Chờ thanh toán
                      <span class="loading-icon">
                        <i class="bi bi-arrow-repeat"></i>
                      </span>
                    </div>
                  </div>

                  <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="prevTab()">
                      Quay lại
                    </button>
                    <button class="nav-btn next-btn" onclick="nextTab()">
                      Tiếp tục
                    </button>
                  </div>
                </div>

                <!-- Tab 3: Success -->
                <div class="tab-content" id="tab-3">
                  <div class="user-info-container text-center">
                    <div class="success-icon">
                      <i class="bi bi-check"></i>
                    </div>
                    <div class="success-title">Thanh toán thành công!</div>
                    <div class="success-text">
                      Cảm ơn bạn đã đăng ký khóa học. Thanh toán của bạn đã
                      thành công.<br />
                      Hóa đơn sẽ được gửi đến email bạn đã đăng ký.
                    </div>
                    <button class="start-course-btn">VÀO HỌC NGAY!</button>
                    <div class="contact-text">
                      Cần hỗ trợ? Hãy liên hệ chúng tôi qua hotline
                      <span class="hotline">0123 456 789</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
      crossorigin="anonymous"
    ></script>

    <script>
      // Initialize the first tab
      let currentTab = 1;
      showTab(currentTab);

      function showTab(tabNumber) {
        // Hide all tabs
        const tabs = document.querySelectorAll(".tab-content");
        tabs.forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show the current tab
        document.getElementById(`tab-${tabNumber}`).classList.add("active");

        document.querySelector(".payment-header-b").style.display =
          tabNumber === 1 ? "block" : "none";

        // Update steps
        updateSteps(tabNumber);
      }

      function updateSteps(tabNumber) {
        // Reset all steps
        const steps = document.querySelectorAll(".step");
        steps.forEach((step, index) => {
          const stepNum = index + 1;
          step.classList.remove("active", "completed");

          const circle = step.querySelector(".step-circle");
          if (stepNum < tabNumber) {
            // Previous steps are completed
            step.classList.add("completed");
            circle.innerHTML = '<i class="bi bi-check"></i>';
          } else if (stepNum === tabNumber) {
            // Current step is active
            step.classList.add("active");
            circle.innerHTML = stepNum;
          } else {
            // Future steps are neither active nor completed
            circle.innerHTML = stepNum;
          }
        });

        // Mark all steps as completed when on the success page
        if (tabNumber === 3) {
          steps.forEach((step) => {
            step.classList.add("completed");
            const circle = step.querySelector(".step-circle");
            circle.innerHTML = '<i class="bi bi-check"></i>';
          });
        }
      }

      function nextTab() {
        if (currentTab < 3) {
          currentTab++;
          showTab(currentTab);
        }
      }

      function prevTab() {
        if (currentTab > 1) {
          currentTab--;
          showTab(currentTab);
        }
      }

      // Add countdown timer functionality
      function startTimer(duration, display) {
        let timer = duration,
          minutes,
          seconds;
        const interval = setInterval(function () {
          minutes = parseInt(timer / 60, 10);
          seconds = parseInt(timer % 60, 10);

          minutes = minutes < 10 ? "0" + minutes : minutes;
          seconds = seconds < 10 ? "0" + seconds : seconds;

          display.textContent = minutes + ":" + seconds;

          if (--timer < 0) {
            clearInterval(interval);
            display.textContent = "00:00";
            // Handle timer expiration
            alert("Thời gian thanh toán đã hết. Vui lòng thử lại.");
          }
        }, 1000);
      }

      // Start the timer when the page loads (15 minutes)
      window.onload = function () {
        const fifteenMinutes = 60 * 15;
        const display = document.querySelector(".timer");

        // Format display initially
        let minutes = parseInt(fifteenMinutes / 60, 10);
        let seconds = parseInt(fifteenMinutes % 60, 10);
        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;
        display.textContent = minutes + ":" + seconds;

        // Only start the timer when tab 2 is active
        document.addEventListener("click", function () {
          if (currentTab === 2 && !window.timerStarted) {
            startTimer(fifteenMinutes, display);
            window.timerStarted = true;
          }
        });
      };

      // Toggle password visibility
      document.querySelector(".bi-eye").addEventListener("click", function () {
        const passwordField = document.getElementById("password");
        const type =
          passwordField.getAttribute("type") === "password"
            ? "text"
            : "password";
        passwordField.setAttribute("type", type);
        this.classList.toggle("bi-eye");
        this.classList.toggle("bi-eye-slash");
      });

      // Coupon functionality
      document
        .getElementById("showCoupons")
        .addEventListener("click", function (e) {
          e.preventDefault();
          const couponList = document.getElementById("couponList");
          if (couponList.style.display === "none") {
            couponList.style.display = "flex";
          } else {
            couponList.style.display = "none";
          }
        });

      // Add click event to all coupon buttons
      const couponButtons = document.querySelectorAll(".coupon-btn");
      couponButtons.forEach((button) => {
        button.addEventListener("click", function () {
          const couponCode = this.getAttribute("data-code");
          document.getElementById("couponInput").value = couponCode;

          // Optional: Auto-apply the coupon
          // document.getElementById('applyCoupon').click();
        });
      });

      // Apply coupon button click
      document
        .getElementById("applyCoupon")
        .addEventListener("click", function () {
          const couponCode = document
            .getElementById("couponInput")
            .value.trim();
          if (couponCode) {
            // Here you would normally verify the coupon with a backend
            // For demo purposes, we'll simulate a discount based on the coupon code
            let discountAmount = 0;

            if (couponCode === "GIAM150K") {
              discountAmount = 150000;
            } else if (couponCode === "GIAM100K") {
              discountAmount = 100000;
            } else if (couponCode === "GIAM50K") {
              discountAmount = 50000;
            } else if (couponCode === "GIAM15OK") {
              discountAmount = 150000;
            }

            if (discountAmount > 0) {
              const originalPrice = 4000000;
              const discountedPrice = originalPrice - discountAmount;

              // Update displayed price
              document.querySelectorAll(
                ".price"
              )[0].textContent = `${discountedPrice.toLocaleString(
                "vi-VN"
              )} VND`;
              document.querySelectorAll(
                ".price"
              )[1].textContent = `${discountedPrice.toLocaleString(
                "vi-VN"
              )} VND`;

              alert(
                `Mã giảm giá ${couponCode} đã được áp dụng. Bạn được giảm ${discountAmount.toLocaleString(
                  "vi-VN"
                )} VND`
              );
            } else {
              alert("Mã giảm giá không hợp lệ hoặc đã hết hạn");
            }
          } else {
            alert("Vui lòng nhập mã giảm giá");
          }
        });

      // Function to download the QR code image
      document
        .getElementById("download-qr-code")
        .addEventListener("click", function () {
          // Create link element
          const link = document.createElement("a");
          link.href = document.getElementById("payment-qr-code").src;
          link.download = "payment-qr-code.png";

          // Trigger download
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });

      // For demo purposes - allow direct navigation to tabs
      // You can uncomment this to test specific tabs
      // showTab(3); // Show the success tab
    </script>
  </body>
</html>
